<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Tracker</title>
    <style>
        :root {
            --color-primary: #208080;
            --color-primary-hover: #1a6666;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #1f2121;
            --color-text-secondary: #626c7c;
            --color-border: #e0e0e0;
            --color-success: #20808d;
            --color-error: #c01530;
            --color-warning: #a84b2f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--color-surface);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            padding: 20px;
            background: var(--color-primary);
            color: white;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .balance-display {
            font-size: 28px;
            font-weight: 600;
            color: #e8f5f5;
        }

        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--color-border);
            background: var(--color-surface);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .tab-button {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-button:hover {
            color: var(--color-text);
            background: rgba(32, 128, 128, 0.05);
        }

        .content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 14px;
            color: var(--color-text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            background: var(--color-surface);
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(32, 128, 128, 0.1);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background: #a01228;
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--color-bg);
            border-radius: 6px;
            border-left: 4px solid var(--color-primary);
        }

        .transaction-item.income {
            border-left-color: var(--color-success);
        }

        .transaction-item.expense {
            border-left-color: var(--color-error);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-category {
            font-weight: 500;
            color: var(--color-text);
            font-size: 14px;
        }

        .transaction-date {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 2px;
        }

        .transaction-description {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 2px;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 16px;
            text-align: right;
            min-width: 100px;
        }

        .transaction-amount.income {
            color: var(--color-success);
        }

        .transaction-amount.expense {
            color: var(--color-error);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 16px;
            background: var(--color-bg);
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .category-breakdown {
            margin-top: 20px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--color-border);
        }

        .category-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .category-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .category-amount {
            font-weight: 600;
            color: var(--color-text);
        }

        .chart-container {
            margin: 20px 0;
            text-align: center;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--color-text);
        }

        .pie-chart {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .chart-legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .savings-card {
            padding: 16px;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(32, 128, 128, 0.2);
        }

        .savings-card-title {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .savings-card-amount {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .savings-card-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .savings-card-bar {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            transition: width 0.3s ease;
        }

        .savings-card-goal {
            font-size: 11px;
            opacity: 0.85;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            background: var(--color-surface);
            color: var(--color-text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .filter-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .categories-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .category-item-edit {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--color-bg);
            border-radius: 6px;
            border: 1px solid var(--color-border);
        }

        .category-item-edit-name {
            font-size: 14px;
            color: var(--color-text);
            font-weight: 500;
        }

        .category-item-edit button {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: flex-end;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-surface);
            width: 100%;
            max-width: 500px;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--color-text);
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                border-radius: 0;
                box-shadow: none;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Finance Tracker</h1>
            <div class="balance-display" id="balanceDisplay">$0.00</div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('add')">Add Transaction</button>
            <button class="tab-button" onclick="switchTab('list')">Transactions</button>
            <button class="tab-button" onclick="switchTab('savings')">Savings</button>
            <button class="tab-button" onclick="switchTab('stats')">Statistics</button>
            <button class="tab-button" onclick="switchTab('settings')">Settings</button>
        </div>

        <div class="content">
            <!-- Add Transaction Tab -->
            <div id="add-tab" class="tab-content">
                <form id="transactionForm" onsubmit="addTransaction(event)">
                    <div class="form-group">
                        <label for="type">Type</label>
                        <select id="type" required onchange="updateCategories()">
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="amount">Amount</label>
                        <input type="number" id="amount" placeholder="0.00" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required></select>
                    </div>

                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="description">Description (Optional)</label>
                        <textarea id="description" placeholder="Add notes..." rows="3"></textarea>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Add Transaction</button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <!-- Transactions List Tab -->
            <div id="list-tab" class="tab-content" style="display: none;">
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterByMonth('all')">All</button>
                    <button class="filter-btn" onclick="filterByMonth('current')">This Month</button>
                    <button class="filter-btn" onclick="filterByMonth('last')">Last 30 Days</button>
                    <button class="filter-btn" onclick="filterByMonth('income')">Income</button>
                    <button class="filter-btn" onclick="filterByMonth('expense')">Expenses</button>
                </div>

                <div id="transactionsList" class="transaction-list"></div>
            </div>

            <!-- Savings Tab -->
            <div id="savings-tab" class="tab-content" style="display: none;">
                <div id="savingsGoals"></div>

                <div style="margin-top: 24px;">
                    <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--color-text);">Add to Savings</h2>
                    <div class="form-group">
                        <label for="savingsType">Fund</label>
                        <select id="savingsType" required>
                            <option value="general">General Savings</option>
                            <option value="emergency">Emergency Fund</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="savingsAmount">Amount</label>
                        <input type="number" id="savingsAmount" placeholder="0.00" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="savingsDescription">Note (Optional)</label>
                        <input type="text" id="savingsDescription" placeholder="e.g., Monthly savings goal contribution">
                    </div>

                    <div class="button-group">
                        <button onclick="addSavings()" class="btn btn-primary">Add to Fund</button>
                        <button onclick="resetSavingsForm()" class="btn btn-secondary">Clear</button>
                    </div>
                </div>

                <div style="margin-top: 24px; padding: 12px; background: var(--color-bg); border-radius: 6px; font-size: 12px; color: var(--color-text-secondary);">
                    <strong>üí° Tip:</strong> Track your savings progress here. You can also allocate a portion of your income directly to savings.
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content" style="display: none;">
                <div style="margin-bottom: 24px;">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--color-text);">Expense Categories</h2>
                    <div id="expenseCategoriesList" class="categories-list"></div>
                    
                    <div class="form-group" style="margin-top: 12px;">
                        <input type="text" id="newExpenseCategory" placeholder="Add new expense category..." class="form-group input">
                    </div>
                    <button onclick="addCategory('expense')" class="btn btn-primary" style="width: 100%;">+ Add Expense Category</button>
                </div>

                <div style="border-top: 1px solid var(--color-border); padding-top: 20px;">
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--color-text);">Income Categories</h2>
                    <div id="incomeCategoriesList" class="categories-list"></div>
                    
                    <div class="form-group" style="margin-top: 12px;">
                        <input type="text" id="newIncomeCategory" placeholder="Add new income category..." class="form-group input">
                    </div>
                    <button onclick="addCategory('income')" class="btn btn-primary" style="width: 100%;">+ Add Income Category</button>
                </div>

                <div style="margin-top: 24px; padding: 12px; background: var(--color-bg); border-radius: 6px; font-size: 12px; color: var(--color-text-secondary);">
                    <strong>üí° Tip:</strong> Customize categories to match your lifestyle. Changes apply immediately to new transactions.
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="stats-tab" class="tab-content" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Income</div>
                        <div class="stat-value" id="totalIncome">$0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Expense</div>
                        <div class="stat-value" id="totalExpense">$0.00</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Spending by Category</div>
                    <svg id="categoryChart" width="100%" height="300" viewBox="0 0 400 300"></svg>
                    <div id="chartLegend" class="chart-legend"></div>
                </div>

                <div class="category-breakdown">
                    <div class="chart-title">Category Breakdown</div>
                    <div id="categoryList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        const state = {
            transactions: [],
            savings: {
                general: 0,
                emergency: 0
            },
            savingsHistory: [],
            currentFilter: 'all',
            currentTab: 'add',
            categories: {
                expense: ['Food', 'Fitness', 'Research', 'Equipment', 'Transport', 'Utilities', 'Other'],
                income: ['Salary', 'Freelance', 'Investment', 'Other']
            },
            categoryColors: {
                'Food': '#FF6B6B',
                'Fitness': '#4ECDC4',
                'Research': '#45B7D1',
                'Equipment': '#FFA07A',
                'Transport': '#98D8C8',
                'Utilities': '#F7DC6F',
                'Other': '#BB8FCE',
                'Salary': '#52C41A',
                'Freelance': '#1890FF',
                'Investment': '#F5222D'
            }
        };

        // Initialize app
        function init() {
            loadData();
            setDateInput();
            updateCategories();
            renderTransactions();
            renderSavings();
            updateStats();
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('financeData');
            if (saved) {
                const data = JSON.parse(saved);
                state.transactions = data.transactions || [];
                state.savings = data.savings || { general: 0, emergency: 0 };
                state.savingsHistory = data.savingsHistory || [];
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('financeData', JSON.stringify({
                transactions: state.transactions,
                savings: state.savings,
                savingsHistory: state.savingsHistory
            }));
        }

        // Set date input to today
        function setDateInput() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }

        // Update categories based on transaction type
        function updateCategories() {
            const type = document.getElementById('type').value;
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '';
            
            state.categories[type].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }

        // Add transaction
        function addTransaction(event) {
            event.preventDefault();

            const transaction = {
                id: Date.now(),
                type: document.getElementById('type').value,
                amount: parseFloat(document.getElementById('amount').value),
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                description: document.getElementById('description').value
            };

            state.transactions.push(transaction);
            state.transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            saveData();
            document.getElementById('transactionForm').reset();
            setDateInput();
            updateCategories();
            updateStats();
            alert('Transaction added successfully!');
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Delete this transaction?')) {
                state.transactions = state.transactions.filter(t => t.id !== id);
                saveData();
                renderTransactions();
                updateStats();
            }
        }

        // Render transactions list
        function renderTransactions() {
            const list = document.getElementById('transactionsList');
            
            let filtered = state.transactions;
            const today = new Date();
            const currentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

            if (state.currentFilter === 'current') {
                filtered = filtered.filter(t => new Date(t.date) >= currentMonth);
            } else if (state.currentFilter === 'last') {
                filtered = filtered.filter(t => new Date(t.date) >= thirtyDaysAgo);
            } else if (state.currentFilter === 'income') {
                filtered = filtered.filter(t => t.type === 'income');
            } else if (state.currentFilter === 'expense') {
                filtered = filtered.filter(t => t.type === 'expense');
            }

            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No transactions yet. Add one to get started!</p></div>';
                return;
            }

            list.innerHTML = filtered.map(t => `
                <div class="transaction-item ${t.type}">
                    <div class="transaction-info">
                        <div class="transaction-category">${t.category}</div>
                        <div class="transaction-date">${new Date(t.date).toLocaleDateString()}</div>
                        ${t.description ? `<div class="transaction-description">${t.description}</div>` : ''}
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="transaction-amount ${t.type}">
                            ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
                        </div>
                        <button onclick="deleteTransaction(${t.id})" class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;">√ó</button>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats() {
            const totalIncome = state.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpense = state.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = totalIncome - totalExpense;

            document.getElementById('balanceDisplay').textContent = `$${balance.toFixed(2)}`;
            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpense').textContent = `$${totalExpense.toFixed(2)}`;

            renderChart();
            renderCategoryBreakdown();
        }

        // Render pie chart
        function renderChart() {
            const expenses = state.transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};

            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });

            const categories = Object.keys(categoryTotals);
            const values = Object.values(categoryTotals);
            const total = values.reduce((a, b) => a + b, 0);

            if (total === 0) {
                document.getElementById('categoryChart').parentElement.innerHTML = 
                    '<div class="empty-state" style="margin: 20px 0;"><p>No expenses yet. Add an expense to see statistics.</p></div>';
                document.getElementById('chartLegend').innerHTML = '';
                return;
            }

            // Simple pie chart using SVG
            const svg = document.getElementById('categoryChart');
            svg.innerHTML = '';

            let currentAngle = 0;
            const slices = [];

            categories.forEach((cat, idx) => {
                const slicePercentage = values[idx] / total;
                const sliceAngle = slicePercentage * 360;
                
                slices.push({
                    category: cat,
                    percentage: slicePercentage,
                    angle: sliceAngle,
                    startAngle: currentAngle,
                    color: state.categoryColors[cat] || '#' + Math.floor(Math.random()*16777215).toString(16)
                });

                currentAngle += sliceAngle;
            });

            // Draw pie slices
            const cx = 150, cy = 100, radius = 70;

            slices.forEach(slice => {
                const startRad = (slice.startAngle - 90) * Math.PI / 180;
                const endRad = (slice.startAngle + slice.angle - 90) * Math.PI / 180;

                const x1 = cx + radius * Math.cos(startRad);
                const y1 = cy + radius * Math.sin(startRad);
                const x2 = cx + radius * Math.cos(endRad);
                const y2 = cy + radius * Math.sin(endRad);

                const largeArc = slice.angle > 180 ? 1 : 0;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`);
                path.setAttribute('fill', slice.color);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');
                svg.appendChild(path);
            });

            // Add center circle for donut effect
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', cx);
            circle.setAttribute('cy', cy);
            circle.setAttribute('r', 40);
            circle.setAttribute('fill', 'white');
            svg.appendChild(circle);

            // Render legend
            const legend = document.getElementById('chartLegend');
            legend.innerHTML = slices.map(slice => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${slice.color};"></div>
                    <span>${slice.category} (${(slice.percentage * 100).toFixed(0)}%)</span>
                </div>
            `).join('');
        }

        // Render category breakdown
        function renderCategoryBreakdown() {
            const expenses = state.transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};

            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });

            const sorted = Object.entries(categoryTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            if (sorted.length === 0) {
                document.getElementById('categoryList').innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">No expenses to display</p>';
                return;
            }

            document.getElementById('categoryList').innerHTML = sorted.map(([cat, amount]) => `
                <div class="category-item">
                    <div class="category-name">
                        <div class="category-dot" style="background-color: ${state.categoryColors[cat]}"></div>
                        ${cat}
                    </div>
                    <div class="category-amount">$${amount.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));

            document.getElementById(tab + '-tab').style.display = 'block';
            event.target.classList.add('active');

            state.currentTab = tab;
            if (tab === 'list') {
                renderTransactions();
            } else if (tab === 'stats') {
                updateStats();
            }
        }

        // Filter by month
        function filterByMonth(filter) {
            state.currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderTransactions();
        }

        // Render categories list
        function renderCategories() {
            const expenseList = document.getElementById('expenseCategoriesList');
            const incomeList = document.getElementById('incomeCategoriesList');

            expenseList.innerHTML = state.categories.expense.map(cat => `
                <div class="category-item-edit">
                    <div class="category-item-edit-name">${cat}</div>
                    <button onclick="deleteCategory('expense', '${cat}')" class="btn btn-danger">Delete</button>
                </div>
            `).join('');

            incomeList.innerHTML = state.categories.income.map(cat => `
                <div class="category-item-edit">
                    <div class="category-item-edit-name">${cat}</div>
                    <button onclick="deleteCategory('income', '${cat}')" class="btn btn-danger">Delete</button>
                </div>
            `).join('');
        }

        // Add category
        function addCategory(type) {
            const inputId = type === 'expense' ? 'newExpenseCategory' : 'newIncomeCategory';
            const input = document.getElementById(inputId);
            const value = input.value.trim();

            if (!value) {
                alert('Please enter a category name');
                return;
            }

            if (state.categories[type].includes(value)) {
                alert('This category already exists');
                return;
            }

            if (value.length > 20) {
                alert('Category name must be 20 characters or less');
                return;
            }

            state.categories[type].push(value);
            input.value = '';
            saveData();
            renderCategories();
            updateCategories();
            alert(`"${value}" added to ${type} categories!`);
        }

        // Delete category
        function deleteCategory(type, category) {
            const hasTransactions = state.transactions.some(t => t.category === category);
            
            if (hasTransactions) {
                alert(`Cannot delete "${category}" - it has existing transactions. Delete those transactions first.`);
                return;
            }

            if (state.categories[type].length <= 1) {
                alert(`You must have at least one ${type} category`);
                return;
            }

            if (confirm(`Delete "${category}" from ${type} categories?`)) {
                state.categories[type] = state.categories[type].filter(c => c !== category);
                saveData();
                renderCategories();
                updateCategories();
            }
        }

        // Render savings cards
        function renderSavings() {
            const container = document.getElementById('savingsGoals');
            const generalGoal = 5000; // Default goal
            const emergencyGoal = 10000; // Default goal

            const generalPercent = Math.min((state.savings.general / generalGoal) * 100, 100);
            const emergencyPercent = Math.min((state.savings.emergency / emergencyGoal) * 100, 100);

            container.innerHTML = `
                <div class="savings-card">
                    <div class="savings-card-title">General Savings</div>
                    <div class="savings-card-amount">$${state.savings.general.toFixed(2)}</div>
                    <div class="savings-card-progress">
                        <div class="savings-card-bar" style="width: ${generalPercent}%"></div>
                    </div>
                    <div class="savings-card-goal">Goal: $${generalGoal.toFixed(2)} (${generalPercent.toFixed(0)}%)</div>
                </div>

                <div class="savings-card" style="background: linear-gradient(135deg, var(--color-error) 0%, #c01228 100%);">
                    <div class="savings-card-title">Emergency Fund</div>
                    <div class="savings-card-amount">$${state.savings.emergency.toFixed(2)}</div>
                    <div class="savings-card-progress">
                        <div class="savings-card-bar" style="width: ${emergencyPercent}%"></div>
                    </div>
                    <div class="savings-card-goal">Goal: $${emergencyGoal.toFixed(2)} (${emergencyPercent.toFixed(0)}%)</div>
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--color-text);">Recent Contributions</h3>
                    <div id="savingsHistoryList"></div>
                </div>
            `;

            renderSavingsHistory();
        }

        // Render savings history
        function renderSavingsHistory() {
            const list = document.getElementById('savingsHistoryList');
            const recent = state.savingsHistory.slice(-10).reverse();

            if (recent.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary); font-size: 12px;">No contributions yet</p>';
                return;
            }

            list.innerHTML = recent.map(entry => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-category">${entry.type === 'general' ? 'üè¶' : 'üö®'} ${entry.type === 'general' ? 'General Savings' : 'Emergency Fund'}</div>
                        <div class="transaction-date">${new Date(entry.date).toLocaleDateString()}</div>
                        ${entry.description ? `<div class="transaction-description">${entry.description}</div>` : ''}
                    </div>
                    <div class="transaction-amount" style="color: var(--color-success);">+$${entry.amount.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // Add to savings
        function addSavings() {
            const type = document.getElementById('savingsType').value;
            const amount = parseFloat(document.getElementById('savingsAmount').value);
            const description = document.getElementById('savingsDescription').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            state.savings[type] += amount;
            state.savingsHistory.push({
                id: Date.now(),
                type: type,
                amount: amount,
                description: description,
                date: new Date().toISOString().split('T')[0]
            });

            saveData();
            resetSavingsForm();
            renderSavings();
            updateStats();
            alert(`Added $${amount.toFixed(2)} to ${type === 'general' ? 'General Savings' : 'Emergency Fund'}!`);
        }

        // Reset savings form
        function resetSavingsForm() {
            document.getElementById('savingsType').value = 'general';
            document.getElementById('savingsAmount').value = '';
            document.getElementById('savingsDescription').value = '';
        }

        // Initialize on load
        init();
        renderCategories();
    </script>
</body>
</html>
